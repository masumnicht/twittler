<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel='stylesheet' href='style.css'>
  </head>
  <body>
    <script>
      $(document).ready(function(){ 
        window.users.forEach(function(name){
          var $userName = $('<li><a class=' + name + ' title="Show Tweets For ' + name + '">' + '@' + name + '</a></li>');
          $userName.appendTo($('.userList'));
        });
        var totalTweetCounter = streams.home.length;
        var retrieveTweets = function(user){
            var index;
            var tweet;
            $('.twittlerStream').text('');
            if(user){
              index = streams.users[user].length-1;
            } else {
              index = streams.home.length-1;
            }
            while(index>=0) {
              if(user){
                tweet = streams.users[user][index];
              } else {
                tweet = streams.home[index];
              }
              var $tweet = $('<div class="row ' + tweet.user + '">' +
                                '<a class="col-md-2 ' + tweet.user + '">@' + tweet.user + '</a>' + 
                                '<div class="message col-md-6">' + tweet.message + '</div>' + 
                                '<div class="timeStamp col-md-4">' + tweet.created_at + '</div>' +
                              '</div>');
              $tweet.appendTo('.twittlerStream').hide().fadeIn(2000);
              index--;
              totalTweetCounter = streams.home.length;
            }
        };
        retrieveTweets();
        $('.userList li').on('click', 'a', function(event){
          event.preventDefault();
          var user = this.getAttribute('class');
          $('a').not(this).hide();
          retrieveTweets(user);
          $('.showAllTweets').remove();
          $('.userList').append($('<button class="showAllTweets btn-primary">Show All Tweets</buttons>'));
          $('.showAllTweets').on('click', function() {
            $('.showAllTweets').remove();
            $('a').not(this).show();
            retrieveTweets();
          });
        });

        var tweetChecker = (function(){
          return setInterval(function() {
            var newTweetCount = streams.home.length;
            var count = newTweetCount - totalTweetCounter;
            $('.showNewTweets').remove();
            if(newTweetCount>totalTweetCounter) {
              $('.twittlerStream').prepend('<div class="showNewTweets">' +
                                              '<button class="showNewTweets">Show ' + count + ' New Tweets' +
                                              '</button>' +
                                            '</div>')
            }
            $('.showNewTweets').on('click', function() {
              retrieveTweets();
              $('a').show();
              $('.showAllTweets').remove();
              $('.showNewTweets').remove();
            });
          },5000);
        })()
      });
    </script> 
    <div class='container'>
      <div class='col-md-12 well text-center'>
        Welcome to Twittler!
      </div>
      <div class='userNames col-md-2'>
        <ul class='userList list-unstyled'>
          Currently Following:
        </ul>
      </div>
      <div class='twittlerStream col-md-9'>
      </div>
    </div>
  </body>
</html>
